pipeline {
    agent any

    environment {
        GIT_USERNAME = credentials('webappcredentials').username
        GIT_PASSWORD = credentials('webappcredentials').password
    }

    stages {
        stage('Checkout') {
            steps {
                // Checkout code from Git repository
                script {
                    withCredentials([usernamePassword(credentialsId: 'webappcredentials', usernameVariable: 'GIT_USERNAME', passwordVariable: 'GIT_PASSWORD')]) {
                        sh """
                            git config --global credential.helper 'store --file=$HOME/.git-credentials'
                            git ls-remote -h https://github.com/sanjaych0311/capstoneproject.git HEAD
                            git clone https://${GIT_USERNAME}:${GIT_PASSWORD}@github.com/sanjaych0311/capstoneproject.git
                        """
                    }
                }
            }
        }

        stage('Build') {
            steps {
                // Build the application (e.g., npm build, Maven, etc.)
                sh 'npm install'
                sh 'npm run build'
            }
        }

        stage('Test') {
            steps {
                // Run unit tests (e.g., Jest, JUnit, etc.)
                sh 'npm test'
            }
        }

        stage('Deploy to Staging') {
            when {
                branch 'testing'
            }
            steps {
                // Deploy to the staging environment
                sh './deploy-staging.sh'
            }
        }

        stage('Deploy to Production') {
            when {
                branch 'production'
            }
            steps {
                // Deploy to the production environment
                sh './deploy-production.sh'
            }
        }
    }
}

